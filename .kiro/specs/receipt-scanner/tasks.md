# Implementation Plan

- [x] 1. Set up KMP project foundation using official template
  - Clone and configure the Kotlin KMP App Template Native repository
  - Set up shared module structure with Clean Architecture layers (domain, data, presentation)
  - Configure Gradle build scripts with version catalogs for dependency management
  - Set up platform-specific modules (androidApp, iosApp) with native UI frameworks
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: set up KMP project foundation with Clean Architecture" && git push`
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 2. Implement core data models and database schema
  - Create shared domain models (Receipt, ReceiptItem, BankTransaction, StoreInfo) in commonMain
  - Define repository interfaces for data access abstraction
  - Implement SQLite database schema with proper relationships and indexes
  - Set up platform-specific database drivers (Room for Android, Core Data bridge for iOS)
  - Create database migration scripts and version management
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement core data models and database schema" && git push`
  - _Requirements: 4.1, 4.2, 4.3, 9.1, 9.2_

- [x] 3. Build bank account integration with Plaid API
  - Integrate Plaid SDK for secure bank authentication and connection
  - Implement BankRepository with transaction fetching and account management
  - Create transaction categorization logic to identify grocery-related purchases
  - Build secure credential storage with encryption for bank connection tokens
  - Implement transaction sync with real-time updates and error handling
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement bank account integration with Plaid API" && git push`
  - _Requirements: 10.1, 10.2, 11.1, 11.2, 11.3_

- [x] 4. Build computer vision pipeline for receipt detection and preprocessing
  - Set up ONNX Runtime Mobile for both Android and iOS platforms in KMP project
  - Download and integrate PaddleOCR PP-OCRv5 detection model (converted to ONNX format)
  - Implement expect/actual pattern for platform-specific ONNX Runtime integration
  - Create real-time receipt boundary detection with bounding box overlay in camera preview
  - Build image preprocessing pipeline (resize, normalize, format conversion for ONNX input)
  - Implement receipt detection confidence scoring for automatic capture triggering
  - Add memory management for model loading and inference operations
  - Create quality assessment pipeline for lighting, focus, and angle evaluation using OpenCV
  - Run `./gradlew clean build` to verify ONNX Runtime integration and model loading
  - Test receipt detection accuracy with various receipt types and lighting conditions
  - Commit and push changes: `git add . && git commit -m "feat: implement computer vision pipeline with PaddleOCR PP-OCRv5 detection" && git push`
  - _Requirements: 1.1, 1.2, 2.1, 2.4, 2.5_

- [x] 4.1 Implement OpenCV Mobile for geometric corrections
  - Set up OpenCV Mobile integration for both Android and iOS platforms
  - Create perspective correction algorithms for skewed receipt images
  - Implement automatic rotation detection and correction
  - Build image enhancement pipeline (contrast, brightness, sharpening)
  - Add noise reduction and image stabilization for camera shake
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement OpenCV Mobile for geometric corrections" && git push`
  - _Requirements: 1.5, 2.6, 4.1_

- [x] 4.2 Create real-time image quality assessment system
  - Implement lighting uniformity analysis using histogram evaluation
  - Build focus quality detection using gradient magnitude analysis
  - Create receipt boundary completeness validation
  - Add optimal distance calculation based on receipt size detection
  - Implement real-time quality scoring with color-coded feedback
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: create real-time image quality assessment system" && git push`
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 5. Implement multi-stage OCR processing architecture with PaddleOCR PP-OCRv5
  - Download and convert PaddleOCR PP-OCRv5 recognition models to ONNX format (text recognition)
  - Design Stage 1: Fast text detection using lightweight detection model (<500ms)
  - Build Stage 2: Full text recognition pipeline using PP-OCRv5 recognition model (1-3 seconds)
  - Create OCREngine interface with expect/actual implementations for Android/iOS
  - Implement model caching and warming strategies to reduce cold-start latency
  - Build OCR stage coordinator to manage detection → recognition → post-processing flow
  - Implement background processing using coroutines to avoid blocking UI threads
  - Add processing stage progress tracking with realistic time estimates based on text density
  - Create memory management system for large model files (detection: ~8MB, recognition: ~12MB)
  - Implement model quantization for faster inference on mobile devices
  - Run `./gradlew clean build` to verify ONNX Runtime integration and model loading
  - Test OCR processing speed and accuracy with real grocery receipts
  - Commit and push changes: `git add . && git commit -m "feat: implement multi-stage OCR with PaddleOCR PP-OCRv5" && git push`
  - _Requirements: 3.1, 3.2, 3.4, 3.5_

- [x] 5.1 Build Stage 1: Fast preview OCR with PaddleOCR PP-OCRv5 text detection
  - Set up PaddleOCR PP-OCRv5 detection model (ch_PP-OCRv5_det_infer.onnx) for fast text region detection
  - Implement platform-specific ONNX Runtime inference engines (Android: OrtSession, iOS: ONNXRuntime)
  - Create fast text region detection pipeline optimized for real-time camera preview (<500ms)
  - Build text density analysis to confirm receipt presence and estimate processing complexity
  - Implement receipt quality scoring based on detected text regions (coverage, alignment, clarity)
  - Add preprocessing optimizations: image downscaling for detection, efficient memory allocation
  - Create text region visualization overlay for camera preview feedback
  - Build quality assessment integration with text detection confidence scores
  - Implement error handling for model loading failures and inference errors
  - Run `./gradlew clean build` to verify ONNX Runtime integration and detection model performance
  - Test detection speed and accuracy with various receipt orientations and lighting conditions
  - Commit and push changes: `git add . && git commit -m "feat: build Stage 1 fast preview OCR with PaddleOCR PP-OCRv5 detection" && git push`
  - _Requirements: 1.2, 2.1, 3.1_

- [x] 5.2 Implement Stage 2: Full OCR processing with PaddleOCR PP-OCRv5 recognition
  - Set up PaddleOCR PP-OCRv5 recognition model (ch_PP-OCRv5_rec_infer.onnx) for full text recognition
  - Create platform-specific OCR engine wrappers using expect/actual pattern for KMP
  - Implement full text recognition pipeline with character-level confidence scores from PP-OCRv5
  - Build text line processing: detection results → cropped regions → recognition → confidence scoring
  - Set up model caching and warming strategies to minimize cold-start latency (preload models on app start)
  - Add memory management for large model files and inference tensors (proper cleanup after processing)
  - Implement batch processing for multiple text regions to optimize inference performance
  - Create text post-processing pipeline: confidence filtering, character correction, line assembly
  - Build progressive feedback system showing recognized text as processing completes
  - Add fallback handling for recognition failures (retry with different preprocessing)
  - Implement model quantization options for faster inference on lower-end devices
  - Run `./gradlew clean build` to verify ONNX Runtime integration and recognition model performance
  - Test recognition accuracy with real grocery receipts and measure processing times
  - Commit and push changes: `git add . && git commit -m "feat: implement Stage 2 full OCR processing with PaddleOCR PP-OCRv5 recognition" && git push`
  - _Requirements: 3.2, 3.3, 4.1, 4.2_

- [ ] 6. Build receipt-specific text structure analysis system
  - Create ReceiptParser class to analyze OCR results from PaddleOCR PP-OCRv5 output
  - Implement merchant header detection using pattern matching, positioning, and font size analysis
  - Build item line identification using text alignment, spacing patterns, and price detection
  - Create price column alignment detection with regex patterns for currency formats ($X.XX, X.XX, etc.)
  - Add total section identification (subtotal, tax, final total) using keyword matching and positioning
  - Implement date/time extraction with multiple format support (MM/DD/YYYY, DD/MM/YYYY, etc.)
  - Build receipt layout classification for major grocery chains (Walmart, Target, Kroger, etc.)
  - Create text region classification (header, items, totals, footer) based on position and content
  - Implement quantity detection in item lines (2x, 3 @, etc.) with price calculation validation
  - Add receipt boundary validation to ensure complete capture of all sections
  - Build confidence scoring for each parsed section based on pattern matching success
  - Create structured data output format (ReceiptData class) from raw OCR text
  - Run `./gradlew clean build` to verify text parsing logic and structured data extraction
  - Test parsing accuracy with receipts from major grocery chains
  - Commit and push changes: `git add . && git commit -m "feat: build receipt-specific text structure analysis system" && git push`
  - _Requirements: 4.2, 4.3, 4.4_

- [ ] 6.1 Implement intelligent item line parsing
  - Create item name extraction with quantity detection (e.g., "2x Bananas")
  - Build price parsing with decimal alignment and currency symbol handling
  - Implement line total calculation and validation against individual prices
  - Add item categorization hints based on common grocery item patterns
  - Create confidence scoring for each parsed item component
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement intelligent item line parsing" && git push`
  - _Requirements: 4.1, 4.2, 5.1_

- [ ] 6.2 Build multi-level confidence scoring system
  - Implement OCR character confidence aggregation from PaddleOCR
  - Create structural validation confidence based on receipt format compliance
  - Add mathematical validation confidence (totals, calculations)
  - Build merchant pattern matching confidence against known grocery chains
  - Create overall receipt confidence score combining all factors
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: build multi-level confidence scoring system" && git push`
  - _Requirements: 4.6, 5.1, 5.2_

- [ ] 7. Add Tesseract OCR as fallback engine for challenging receipts
  - Integrate Tesseract Mobile (TessTwo for Android, TesseractOCRiOS for iOS) as secondary OCR engine
  - Implement confidence-based fallback logic: if PaddleOCR confidence < 0.7, retry with Tesseract
  - Create unified OCRResult interface to standardize output from both PaddleOCR and Tesseract
  - Build OCREngineManager to coordinate between primary (PaddleOCR) and fallback (Tesseract) engines
  - Add preprocessing optimizations specific to Tesseract (contrast enhancement, noise reduction)
  - Implement performance monitoring to track OCR engine effectiveness and processing times
  - Create memory management system to handle multiple OCR engines without excessive RAM usage
  - Build retry logic with different preprocessing approaches for failed OCR attempts
  - Add engine selection heuristics based on receipt characteristics (crumpled, faded, etc.)
  - Implement parallel processing option for speed-critical scenarios (both engines simultaneously)
  - Create fallback chain: PaddleOCR → Tesseract → Manual entry prompt
  - Run `./gradlew clean build` to verify dual OCR engine integration and fallback logic
  - Test fallback effectiveness with challenging receipt images (crumpled, faded, skewed)
  - Commit and push changes: `git add . && git commit -m "feat: add Tesseract OCR as fallback engine for challenging receipts" && git push`
  - _Requirements: 4.1, 4.6, 7.2_

- [ ] 8. Build comprehensive OCR validation system with intelligent heuristics
  - Create OCRValidator class with multi-level validation pipeline for PaddleOCR results
  - Implement currency format validation using regex patterns ($X.XX, X.XX USD, etc.) with regional support
  - Build mathematical consistency validation: item prices × quantities = line totals, sum = subtotal
  - Add item structure validation: reasonable item names, valid price ranges, logical quantities
  - Create merchant name validation against comprehensive grocery chain database (500+ chains)
  - Implement receipt format validation for major grocery store layouts and receipt templates
  - Build confidence scoring system combining OCR confidence + validation heuristics
  - Add contextual validation: grocery-specific item names, reasonable price ranges per category
  - Implement cross-validation between multiple OCR engines when available
  - Create validation error categorization (low confidence, math errors, format issues, etc.)
  - Build automatic correction suggestions for common OCR errors (0→O, 1→I, etc.)
  - Add receipt completeness validation (header, items, totals all present)
  - Implement validation result visualization for user review and correction
  - Create validation bypass options for edge cases and unusual receipt formats
  - Run `./gradlew clean build` to verify validation logic and heuristic accuracy
  - Test validation effectiveness with diverse receipt types and intentionally corrupted OCR results
  - Commit and push changes: `git add . && git commit -m "feat: build comprehensive OCR validation system with intelligent heuristics" && git push`
  - _Requirements: 4.6, 5.1, 5.2, 5.3_

- [ ] 9. Implement platform-specific camera integration
  - Build Android camera implementation using CameraX with real-time preview
  - Create iOS camera implementation using AVFoundation
  - Add real-time receipt detection with boundary overlay visualization
  - Implement automatic capture when receipt is properly framed
  - Build camera guidance system with quality indicators and feedback
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement platform-specific camera integration" && git push`
  - _Requirements: 1.1, 1.2, 1.4, 2.1, 2.2, 2.3, 2.6_

- [ ] 10. Create engaging OCR processing experience
  - Design progressive processing UI with item-by-item discovery animations
  - Implement contextual processing messages based on receipt complexity
  - Add haptic feedback and visual confirmations during processing
  - Build processing progress tracking with realistic time estimates
  - Create error recovery flows for failed OCR processing
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: create engaging OCR processing experience" && git push`
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 11. Build manual correction interface for OCR results
  - Create editable receipt item components with inline editing
  - Implement category selection UI with predefined grocery categories
  - Add real-time total recalculation when items are modified
  - Build validation error highlighting with clear correction guidance
  - Create save/cancel flows for manual corrections
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: build manual correction interface for OCR results" && git push`
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 12. Implement intelligent transaction matching system
  - Create TransactionMatcher with amount, date, and merchant-based matching
  - Build automatic matching logic for perfect matches (same amount, merchant, date)
  - Implement manual matching UI for ambiguous cases
  - Add match confidence scoring and user confirmation flows
  - Create enhanced transaction views showing receipt details
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement intelligent transaction matching system" && git push`
  - _Requirements: 12.1, 12.2, 12.3, 12.4, 12.5, 12.6_

- [ ] 13. Add offline capability with queued processing
  - Implement OfflineManager for local receipt image storage
  - Create encrypted local storage for pending OCR processing
  - Build automatic processing queue when network connectivity returns
  - Add offline status indicators and user notifications
  - Implement storage management with cleanup of processed images
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: add offline capability with queued processing" && git push`
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 14. Build receipt history and search functionality
  - Create receipt list UI with chronological display and filtering
  - Implement search functionality by store name, date range, and amount
  - Add receipt detail views with full itemized data display
  - Build export functionality for receipt data (CSV, JSON formats)
  - Implement receipt deletion with confirmation and bulk operations
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: build receipt history and search functionality" && git push`
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [ ] 15. Implement security and privacy features
  - Add device-level encryption for stored receipt images and data
  - Implement biometric authentication for app access (optional)
  - Create secure HTTPS connections for all external API calls
  - Add app backgrounding protection to hide sensitive information
  - Build data export and deletion features for user privacy control
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: implement security and privacy features" && git push`
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 16. Add comprehensive error handling and recovery
  - Implement error handling for camera permission and access issues
  - Create retry logic for network failures and OCR processing errors
  - Build user-friendly error messages with actionable recovery steps
  - Add crash reporting and error logging (without sensitive data)
  - Implement graceful degradation when services are unavailable
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: add comprehensive error handling and recovery" && git push`
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 17. Optimize performance and conduct testing
  - Implement background processing for all CPU-intensive operations
  - Add OCR model caching and result caching for improved performance
  - Create comprehensive unit tests for business logic and use cases
  - Build integration tests for end-to-end receipt scanning flows
  - Conduct performance testing to ensure 3-second OCR processing target
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Run `./gradlew clean build test` to verify all tests pass and performance optimizations work
  - Analyze build and test errors for performance bottlenecks, test failures, or optimization conflicts
  - Commit and push changes: `git add . && git commit -m "feat: optimize performance and add comprehensive testing" && git push`
  - _Requirements: 3.4, 4.1, 6.1_

- [ ] 18. Build native UI implementations
  - Create Android UI using Jetpack Compose with Material Design
  - Build iOS UI using SwiftUI with native iOS design patterns
  - Implement consistent user experience across both platforms
  - Add accessibility features and screen reader support
  - Create responsive layouts for different screen sizes and orientations
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: build native UI implementations for Android and iOS" && git push`
  - _Requirements: 1.1, 1.4, 2.1, 3.1, 5.1, 9.2_

- [ ] 19. Integrate and test complete user flows
  - Test complete flow: bank connection → transaction import → receipt scanning → matching
  - Validate OCR accuracy targets (>90%) with real grocery receipts
  - Test offline functionality and automatic sync when online
  - Verify security features and data encryption
  - Conduct user acceptance testing for camera guidance and processing experience
  - Run `./gradlew clean build test` to verify complete integration and all end-to-end flows
  - Analyze build and test errors for integration issues, flow coordination problems, or end-to-end testing failures
  - Run `./gradlew clean build` to verify project setup and resolve any build issues
  - Analyze build output for dependency conflicts, version mismatches, or missing configurations across all platforms.
  - Commit and push changes: `git add . && git commit -m "feat: complete integration and end-to-end testing" && git push`
  - _Requirements: All requirements integration testing_
